<!DOCTYPE html>
<html lang="tr">
<head>
Â  <meta charset="UTF-8" />
Â  <title>QR Scanner - AttendAI</title>
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>

<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4 text-white">

Â  Â  Â  Â  <div class="bg-gray-800 p-6 rounded-2xl shadow-xl w-full max-w-sm mb-6 border border-gray-700">
Â  Â  <p id="login-status" class="text-base font-semibold text-red-400 mb-4 text-center">GiriÅŸ YapÄ±lmadÄ±</p>

Â  Â  Â  Â  <input type="email" id="auth-email" style="display: none;">
Â  Â  <input type="password" id="auth-password" style="display: none;">
Â  Â  <select id="auth-role" style="display: none;"></select>
Â  Â  <div id="sign-in-buttons" class="flex space-x-2" style="display: none;"></div>
Â  Â  
Â  Â  Â  Â  <button id="sign-out-button" onclick="signOutUser()" 
Â  Â  Â  Â  class="w-full mt-2 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-xl transition duration-150" 
Â  Â  Â  Â  style="display: none;">
Â  Â  Â  Â  Ã‡Ä±kÄ±ÅŸ Yap
Â  Â  </button>

Â  </div>

Â  Â  Â  Â  <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl w-full max-w-sm flex flex-col items-center border border-gray-700">
Â  Â  <h2 class="text-3xl font-bold text-teal-400 mb-6">ðŸ“· Yoklama TaramasÄ±</h2>

Â  Â  <div id="qr-reader" class="w-full bg-black rounded-lg shadow-inner mb-6 border-2 border-teal-500" style="height: 300px;"></div>

Â  Â  <div class="w-full text-center">
Â  Â  Â  <p class="text-sm font-medium text-gray-400 mb-1">ðŸŽ¯ Son Okunan Veri:</p>
Â  Â  Â  <p id="last-scan" class="text-base text-white break-words mb-4 bg-gray-700 p-2 rounded-lg">HenÃ¼z veri yok</p>

Â  Â  Â  <hr class="border-gray-700 my-4">

Â  Â  Â  <p class="text-base font-medium text-gray-400 mb-1">ðŸš€ KatÄ±lÄ±m Durumu:</p>
Â  Â  Â  <p id="record-status" class="text-xl font-extrabold text-yellow-400">Tarama bekleniyor...</p>
Â  Â  </div>
Â  </div>

Â  Â  <script type="module" src="firebase.js"></script>

Â  <script>
Â  Â  let html5QrCode = null;
Â  Â  const qrCodeId = "qr-reader";

Â  Â  function onScanSuccess(decodedText, decodedResult) {
Â  Â  Â  document.getElementById('last-scan').innerText = decodedText;
Â  Â  Â  document.getElementById('record-status').innerText = 'â³ VeritabanÄ±na KayÄ±t YapÄ±lÄ±yor...';
Â  Â  Â  console.log(`QR Kod Verisi: ${decodedText}`); 

Â  Â  Â  if (window.recordAttendance) {
Â  Â  Â  Â  window.recordAttendance(decodedText);
Â  Â  Â  } else {
Â  Â  Â  Â  console.error("âš ï¸ recordAttendance fonksiyonu bulunamadÄ±!");
Â  Â  Â  }
Â  Â  }

Â  Â  function onScanFailure(error) {
Â  Â  Â  // sessizce geÃ§
Â  Â  }

Â  Â  // ðŸ“¸ Kamera BaÅŸlatma
Â  Â  window.startQrCodeScanner = function () {
Â  Â  Â  if (html5QrCode) {
Â  Â  Â  Â  html5QrCode.stop().catch(err => console.warn("Ã–nceki tarayÄ±cÄ± durdurulurken hata:", err));
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  html5QrCode = new Html5Qrcode(qrCodeId);
Â  Â  Â  const config = { fps: 10, qrbox: { width: 250, height: 250 }, rememberLastUsedCamera: true };

Â  Â  Â  html5QrCode.start(
Â  Â  Â  Â  { facingMode: "environment" },
Â  Â  Â  Â  config,
Â  Â  Â  Â  onScanSuccess,
Â  Â  Â  Â  onScanFailure
Â  Â  Â  ).catch(err => {
Â  Â  Â  Â  document.getElementById('record-status').innerText = 'âŒ Kamera BaÅŸlatÄ±lamadÄ±! LÃ¼tfen izinleri kontrol edin.';
Â  Â  Â  Â  console.error("Kamera BaÅŸlatma HatasÄ±:", err);
Â  Â  Â  });
Â  Â  }

Â  Â  // ðŸ“´ Kamera Durdurma
Â  Â  window.stopQrCodeScanner = function () {
Â  Â  Â  if (html5QrCode) {
Â  Â  Â  Â  html5QrCode.stop().catch(err => console.error("TarayÄ±cÄ± durdurulurken hata:", err));
Â  Â  Â  Â  html5QrCode = null; 
Â  Â  Â  }
Â  Â  }

Â  </script>
</body>
</html>